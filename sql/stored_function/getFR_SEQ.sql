DROP FUNCTION IF EXISTS getFR_Seq;
DELIMITER $$
CREATE FUNCTION getFR_Seq( CATEG VARCHAR(30))
	RETURNS INT
BEGIN
	DECLARE num INT;
	DECLARE cd VARCHAR(30);
	SET cd = 'NULL';
    SET num = -1;
    SELECT CT.CODE INTO cd FROM TB_CATEG CT
    WHERE CT.CATEGORY = CATEG;
    IF(cd != 'NULL') THEN
		SELECT FR.SEQ INTO num FROM TB_FREE FR 
		INNER JOIN TB_CATEG CT
		ON FR.CT_CODE = CT.CODE
		WHERE CT.CATEGORY = CATEG ORDER BY SEQ DESC LIMIT 1;
		IF (num = -1) THEN
			SET num = 1;
		ELSE
			SET num = num + 1;
		END IF;
    ELSE
		SET num = -1;
	END IF;
    RETURN num;
END $$
DELIMITER ;